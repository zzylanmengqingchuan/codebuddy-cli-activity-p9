<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üíï ÊÅãÁà±Â§©Êï∞ËÆ°ÁÆóÂô® & ÁÇ´ÈÖ∑3DÁÖßÁâáÂ±ïÁ§∫</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'PingFang SC', 'Helvetica Neue', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 25%, #fecfef 75%, #ff9a9e 100%);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 20%, rgba(255, 182, 193, 0.4) 0%, transparent 40%),
                radial-gradient(circle at 80% 80%, rgba(255, 105, 180, 0.3) 0%, transparent 40%);
            pointer-events: none;
            z-index: -1;
            animation: backgroundFloat 15s ease-in-out infinite;
        }

        @keyframes backgroundFloat {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(2deg); }
        }

        .container {
            max-width: 450px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        /* ÊÅãÁà±‰ø°ÊÅØËæìÂÖ•ÁïåÈù¢ */
        .love-info-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 35px;
            padding: 50px 35px;
            box-shadow: 0 25px 80px rgba(255, 105, 180, 0.4);
            backdrop-filter: blur(25px);
            border: 2px solid rgba(255, 182, 193, 0.4);
            animation: slideInUp 1s ease-out;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(60px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, #ff6b9d, #ff1744);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 15px;
            font-weight: 800;
            animation: titleGlow 3s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }

        .subtitle {
            color: #777;
            font-size: 1.1rem;
            font-weight: 400;
        }

        .love-form {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .couple-inputs {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .input-group {
            flex: 1;
        }

        .input-group label {
            display: block;
            margin-bottom: 12px;
            color: #666;
            font-size: 1rem;
            font-weight: 600;
        }

        .input-group input {
            width: 100%;
            padding: 18px 24px;
            border: 2px solid rgba(255, 182, 193, 0.4);
            border-radius: 30px;
            font-size: 1.1rem;
            background: rgba(255, 255, 255, 0.9);
            transition: all 0.4s ease;
            outline: none;
            font-weight: 500;
        }

        .input-group input:focus {
            border-color: #ff69b4;
            background: rgba(255, 255, 255, 1);
            box-shadow: 0 0 30px rgba(255, 105, 180, 0.4);
            transform: translateY(-3px);
        }

        .heart-connector {
            font-size: 2.5rem;
            animation: heartBeat 2s ease-in-out infinite;
            margin-top: 30px;
            user-select: none;
            filter: drop-shadow(0 4px 8px rgba(255, 105, 180, 0.5));
        }

        @keyframes heartBeat {
            0%, 50%, 100% { transform: scale(1); }
            25%, 75% { transform: scale(1.3); }
        }

        .date-input-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .date-input-group label {
            color: #666;
            font-size: 1rem;
            font-weight: 600;
        }

        .date-input-group input {
            padding: 18px 24px;
            border: 2px solid rgba(255, 182, 193, 0.4);
            border-radius: 30px;
            font-size: 1.1rem;
            background: rgba(255, 255, 255, 0.9);
            transition: all 0.4s ease;
            outline: none;
            font-weight: 500;
        }

        .date-input-group input:focus {
            border-color: #ff69b4;
            background: rgba(255, 255, 255, 1);
            box-shadow: 0 0 30px rgba(255, 105, 180, 0.4);
        }

        .upload-area {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2), rgba(255, 182, 193, 0.1));
            border: 3px dashed rgba(255, 105, 180, 0.6);
            border-radius: 25px;
            padding: 50px 25px;
            margin: 25px 0;
            cursor: pointer;
            transition: all 0.4s ease;
            backdrop-filter: blur(15px);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .upload-area:hover {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.3), rgba(255, 182, 193, 0.2));
            border-color: #ff1744;
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(255, 105, 180, 0.3);
        }

        .upload-content {
            color: #666;
            position: relative;
            z-index: 1;
        }

        .upload-content svg {
            margin-bottom: 20px;
            opacity: 0.8;
            color: #ff69b4;
        }

        .upload-content p {
            font-size: 1.2rem;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .upload-hint {
            font-size: 1rem !important;
            opacity: 0.8;
            font-weight: 400 !important;
        }

        .demo-btn {
            background: linear-gradient(135deg, #ff6b9d, #ff1744);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 1rem;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
            font-weight: 600;
            box-shadow: 0 8px 25px rgba(255, 105, 180, 0.4);
        }

        .demo-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(255, 105, 180, 0.6);
        }

        .uploaded-count {
            text-align: center;
            color: #666;
            font-size: 1.1rem;
            margin: 20px 0;
            padding: 15px 25px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2), rgba(255, 182, 193, 0.1));
            border-radius: 25px;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 182, 193, 0.3);
            font-weight: 600;
        }

        .create-wall-btn {
            background: linear-gradient(135deg, #ff6b9d, #ff1744);
            color: white;
            border: none;
            padding: 22px 35px;
            border-radius: 35px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.4s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            font-weight: 700;
            box-shadow: 0 15px 40px rgba(255, 105, 180, 0.5);
            width: 100%;
            margin-top: 25px;
        }

        .create-wall-btn:disabled {
            background: linear-gradient(135deg, #ccc, #999);
            cursor: not-allowed;
            box-shadow: none;
        }

        .create-wall-btn:hover:not(:disabled) {
            transform: translateY(-4px);
            box-shadow: 0 20px 50px rgba(255, 105, 180, 0.6);
        }

        /* 3DÂ±ïÁ§∫ÁïåÈù¢ */
        .photo-wall-container {
            margin-top: 40px;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }

        .love-display {
            text-align: center;
            margin-bottom: 35px;
            padding: 35px;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 30px;
            box-shadow: 0 20px 60px rgba(255, 105, 180, 0.4);
            backdrop-filter: blur(25px);
            border: 2px solid rgba(255, 182, 193, 0.4);
        }

        .love-display .couple-names {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
            font-size: 1.5rem;
            font-weight: 700;
            flex-wrap: wrap;
        }

        .love-display .name1, 
        .love-display .name2 {
            color: #ff1744;
            padding: 12px 20px;
            background: linear-gradient(135deg, rgba(255, 182, 193, 0.3), rgba(255, 255, 255, 0.5));
            border-radius: 25px;
            border: 2px solid rgba(255, 105, 180, 0.4);
            backdrop-filter: blur(10px);
        }

        .love-display .love-symbol {
            font-size: 2.5rem;
            animation: heartBeat 2s ease-in-out infinite;
        }

        .love-days {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .love-text {
            color: #777;
            font-size: 1.3rem;
            font-weight: 500;
        }

        .love-days .days-number {
            font-size: 3.5rem;
            font-weight: 900;
            background: linear-gradient(135deg, #ff6b9d, #ff1744);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: numberPulse 3s ease-in-out infinite;
        }

        @keyframes numberPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .love-days .days-unit {
            font-size: 1.8rem;
            color: #ff1744;
            font-weight: 700;
        }

        /* ÊéßÂà∂ÊåâÈíÆÂå∫Âüü */
        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 35px;
            padding: 25px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 182, 193, 0.3);
            flex-wrap: wrap;
            gap: 20px;
            box-shadow: 0 10px 30px rgba(255, 105, 180, 0.2);
        }

        .control-btn {
            background: linear-gradient(135deg, #ff6b9d, #ff1744);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            font-weight: 600;
            box-shadow: 0 8px 25px rgba(255, 105, 180, 0.3);
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 35px rgba(255, 105, 180, 0.5);
        }

        .control-btn.secondary {
            background: rgba(255, 182, 193, 0.8);
            color: #ff1744;
        }

        /* 3DÁÖßÁâáËΩÆÊí≠ÂÆπÂô® */
        .photo-wall-wrapper {
            perspective: 1500px;
            perspective-origin: center center;
            height: 80vh;
            min-height: 600px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
            background: 
                linear-gradient(135deg, 
                    rgba(45, 45, 95, 0.95) 0%, 
                    rgba(70, 50, 120, 0.85) 30%, 
                    rgba(95, 75, 145, 0.75) 70%, 
                    rgba(120, 100, 170, 0.65) 100%),
                radial-gradient(circle at 30% 30%, rgba(255, 182, 193, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 70% 70%, rgba(138, 43, 226, 0.15) 0%, transparent 50%);
            border-radius: 30px;
            border: 2px solid rgba(255, 182, 193, 0.4);
            box-shadow: 
                0 25px 80px rgba(255, 105, 180, 0.4),
                0 15px 40px rgba(0, 0, 0, 0.3),
                inset 0 2px 0 rgba(255, 255, 255, 0.1);
        }

        /* 3DËΩÆÊí≠ÂÆπÂô® */
        .photo-wall {
            position: relative;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
        }

        /* 3DËΩÆÊí≠ÁªÑ */
        .carousel-3d {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 350px;
            height: 450px;
            transform-style: preserve-3d;
            animation: rotate3D 25s linear infinite;
        }

        .carousel-3d.paused {
            animation-play-state: paused;
        }

        /* 3DÂç°Áâá */
        .card-3d {
            position: absolute;
            width: 320px;
            height: 420px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 
                0 30px 100px rgba(0, 0, 0, 0.8),
                0 15px 50px rgba(0, 0, 0, 0.6),
                0 5px 20px rgba(0, 0, 0, 0.4),
                inset 0 2px 0 rgba(255, 255, 255, 0.8),
                inset 0 -2px 0 rgba(0, 0, 0, 0.1);
            transition: all 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            cursor: pointer;
            backdrop-filter: blur(20px) saturate(150%);
            border: 3px solid rgba(255, 255, 255, 0.3);
        }

        .card-3d::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                linear-gradient(135deg, 
                    rgba(255, 255, 255, 0.4) 0%, 
                    transparent 30%, 
                    rgba(255, 182, 193, 0.2) 70%, 
                    rgba(138, 43, 226, 0.1) 100%),
                radial-gradient(circle at 20% 20%, rgba(255, 255, 255, 0.6) 0%, transparent 40%);
            pointer-events: none;
            z-index: 2;
            border-radius: 17px;
            opacity: 0.8;
        }

        .card-3d::after {
            content: '';
            position: absolute;
            top: -4px;
            left: -4px;
            right: -4px;
            bottom: -4px;
            background: 
                linear-gradient(45deg, 
                    rgba(255, 105, 180, 0.6) 0%, 
                    rgba(138, 43, 226, 0.4) 25%, 
                    rgba(75, 0, 130, 0.3) 50%, 
                    rgba(138, 43, 226, 0.4) 75%, 
                    rgba(255, 105, 180, 0.6) 100%);
            border-radius: 24px;
            z-index: -1;
            opacity: 0;
            transition: opacity 0.6s ease;
            filter: blur(15px);
        }

        .card-3d:hover {
            transform: scale(1.2) translateZ(120px) rotateY(15deg);
            box-shadow: 
                0 50px 150px rgba(0, 0, 0, 0.9),
                0 25px 80px rgba(0, 0, 0, 0.7),
                0 0 100px rgba(255, 105, 180, 0.8),
                0 0 50px rgba(138, 43, 226, 0.6),
                0 0 150px rgba(255, 182, 193, 0.4),
                inset 0 3px 0 rgba(255, 255, 255, 0.9),
                inset 0 -3px 0 rgba(0, 0, 0, 0.2);
            z-index: 1000;
            border: 3px solid rgba(255, 105, 180, 0.8);
        }

        .card-3d:hover::after {
            opacity: 1;
            animation: cardGlow 2s ease-in-out infinite;
        }

        .card-3d img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            border-radius: 17px;
            transition: all 0.6s ease;
            position: relative;
            z-index: 1;
        }

        .card-3d:hover img {
            transform: scale(1.05);
            filter: brightness(1.15) saturate(1.3) contrast(1.1);
        }

        /* Âç°Áâá‰ø°ÊÅØË¶ÜÁõñÂ±Ç */
        .card-info {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: 
                linear-gradient(transparent, 
                    rgba(0, 0, 0, 0.8) 30%, 
                    rgba(0, 0, 0, 0.95) 100%);
            color: white;
            padding: 25px 20px 20px;
            transform: translateY(100%);
            transition: transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            z-index: 3;
        }

        .card-3d:hover .card-info {
            transform: translateY(0);
        }

        .card-info h3 {
            font-size: 1.2rem;
            margin-bottom: 8px;
            font-weight: 700;
            color: #fff;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }

        .card-info p {
            font-size: 0.95rem;
            opacity: 0.9;
            color: rgba(255, 255, 255, 0.8);
        }

        /* ‰∫§‰∫íÊèêÁ§∫ */
        .interaction-hint {
            position: absolute;
            bottom: 25px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px 25px;
            border-radius: 25px;
            font-size: 1rem;
            backdrop-filter: blur(15px);
            animation: hintFloat 8s ease-in-out infinite;
            pointer-events: none;
            font-weight: 500;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        @keyframes hintFloat {
            0%, 20%, 80%, 100% {
                opacity: 0.9;
                transform: translateX(-50%) translateY(0px);
            }
            40%, 60% {
                opacity: 0.4;
                transform: translateX(-50%) translateY(-5px);
            }
        }

        /* 3DËΩÆÊí≠Âä®Áîª */
        @keyframes rotate3D {
            0% {
                transform: translate(-50%, -50%) rotateY(0deg);
            }
            100% {
                transform: translate(-50%, -50%) rotateY(360deg);
            }
        }

        @keyframes cardGlow {
            0%, 100% {
                opacity: 0.8;
                transform: scale(1);
            }
            50% {
                opacity: 1;
                transform: scale(1.1);
            }
        }

        /* ÊµÆÂä®Áà±ÂøÉÊïàÊûú */
        .floating-hearts {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
            overflow: hidden;
        }

        .floating-heart {
            position: absolute;
            font-size: 1.8rem;
            opacity: 0.8;
            animation: floatUp 8s linear infinite;
        }

        @keyframes floatUp {
            0% {
                transform: translateY(100vh) rotate(0deg) scale(0);
                opacity: 0;
            }
            10% {
                opacity: 0.8;
                transform: translateY(90vh) rotate(45deg) scale(0.6);
            }
            90% {
                opacity: 0.8;
                transform: translateY(10vh) rotate(315deg) scale(1.2);
            }
            100% {
                opacity: 0;
                transform: translateY(-10vh) rotate(360deg) scale(0.6);
            }
        }

        /* ÂìçÂ∫îÂºèËÆæËÆ° */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .love-info-section, .photo-wall-container {
                padding: 30px 25px;
                border-radius: 25px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .couple-inputs {
                flex-direction: column;
                gap: 25px;
            }
            
            .heart-connector {
                margin-top: 0;
                font-size: 2rem;
            }
            
            .photo-wall-wrapper {
                height: 60vh;
                min-height: 400px;
            }
            
            .carousel-3d {
                width: 250px;
                height: 320px;
            }
            
            .card-3d {
                width: 220px;
                height: 300px;
            }
        }

        /* Âä†ËΩΩÂä®Áîª */
        .loading {
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 3px solid rgba(255,255,255,.4);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ÈöêËóèÂÖÉÁ¥† */
        .hidden {
            display: none !important;
        }

        /* Ê∑°ÂÖ•Âä®Áîª */
        .fade-in {
            animation: fadeIn 1s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ÊÅãÁà±‰ø°ÊÅØËæìÂÖ•ÁïåÈù¢ -->
        <div class="love-info-section" id="loveInfoSection">
            <div class="header">
                <h1>üíï Êàë‰ª¨ÁöÑÁà±ÊÉÖ3DÂõûÂøÜÂ¢ô</h1>
                <p class="subtitle">ËÆ∞ÂΩïÊØè‰∏Ä‰∏™ÁæéÂ•ΩÁû¨Èó¥ÔºåËÆ°ÁÆóÊàë‰ª¨ÁöÑÁîúËúúÊó∂ÂÖâ</p>
            </div>
            
            <div class="love-form">
                <div class="couple-inputs">
                    <div class="input-group">
                        <label for="name1">üë´ ÊàëÁöÑÂêçÂ≠ó</label>
                        <input type="text" id="name1" placeholder="ËæìÂÖ•‰Ω†ÁöÑÂêçÂ≠ó" maxlength="10">
                    </div>
                    <div class="heart-connector">üíï</div>
                    <div class="input-group">
                        <label for="name2">üë´ TAÁöÑÂêçÂ≠ó</label>
                        <input type="text" id="name2" placeholder="ËæìÂÖ•TAÁöÑÂêçÂ≠ó" maxlength="10">
                    </div>
                </div>
                
                <div class="date-input-group">
                    <label for="startDate">üìÖ Âú®‰∏ÄËµ∑ÁöÑÊó•Êúü</label>
                    <input type="date" id="startDate" max="" required>
                </div>
                
                <div class="upload-area" id="uploadArea">
                    <div class="upload-content">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="7,10 12,15 17,10"/>
                            <line x1="12" y1="15" x2="12" y2="3"/>
                        </svg>
                        <p>‰∏ä‰º†Êàë‰ª¨ÁöÑÁæéÂ•ΩÂõûÂøÜ</p>
                        <p class="upload-hint">ÊîØÊåÅ JPG„ÄÅPNG Ê†ºÂºèÔºåËá≥Â∞ë8Âº†ÁÖßÁâá</p>
                        <button type="button" id="demoBtn" class="demo-btn">üì∏ Âä†ËΩΩÊºîÁ§∫ÂõæÁâá</button>
                    </div>
                    <input type="file" id="fileInput" multiple accept="image/*" style="display: none;">
                </div>
                
                <div class="uploaded-count">
                    Â∑≤‰∏ä‰º†: <span id="imageCount">0</span> Âº†ÂõæÁâá
                </div>
                
                <button type="button" id="createWallBtn" class="create-wall-btn" disabled>
                    <span>üíñ</span>
                    <span>ÂàõÂª∫Êàë‰ª¨ÁöÑ3DÂõûÂøÜÂ¢ô</span>
                    <span>üíñ</span>
                </button>
            </div>
        </div>

        <!-- 3DÁÖßÁâáÂ¢ôÂ±ïÁ§∫ÁïåÈù¢ -->
        <div class="photo-wall-container" id="photoWallContainer" style="display: none;">
            <!-- ÊÅãÁà±‰ø°ÊÅØÊòæÁ§∫ -->
            <div class="love-display">
                <div class="couple-names">
                    <span class="name1" id="displayName1"></span>
                    <span class="love-symbol">üíï</span>
                    <span class="name2" id="displayName2"></span>
                </div>
                <div class="love-days">
                    <span class="love-text">Êàë‰ª¨Â∑≤ÁªèÁõ∏Áà±‰∫Ü</span>
                    <span class="days-number" id="daysNumber">520</span>
                    <span class="days-unit">Â§©</span>
                </div>
            </div>
            
            <div class="controls">
                <button id="resetBtn" class="control-btn secondary">üîÑ ÈáçÊñ∞ÂºÄÂßã</button>
                <button id="pauseBtn" class="control-btn">‚è∏Ô∏è ÊöÇÂÅúÊóãËΩ¨</button>
                <button id="speedUpBtn" class="control-btn">‚ö° Âä†ÈÄü</button>
                <button id="slowDownBtn" class="control-btn">üêå ÂáèÈÄü</button>
                <button id="shareBtn" class="control-btn">üì± ÁîüÊàêÂàÜ‰∫´ÂõæÁâá</button>
            </div>
            
            <div class="photo-wall-wrapper">
                <div class="photo-wall" id="photoWall">
                    <!-- 3DÁÖßÁâáËΩÆÊí≠Â∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê -->
                </div>
                <div class="interaction-hint" id="interactionHint">
                    <p>üí´ Èº†Ê†áÊÇ¨ÂÅúÊü•ÁúãÁÖßÁâá | ÁÇπÂáªÊöÇÂÅúÊóãËΩ¨</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ÊµÆÂä®Áà±ÂøÉÊïàÊûú -->
    <div class="floating-hearts" id="floatingHearts"></div>

    <script>
        class Enhanced3DPhotoWall {
            constructor() {
                this.images = [];
                this.loveStartDate = null;
                this.coupleName1 = '';
                this.coupleName2 = '';
                this.animationSpeed = 1;
                this.isPaused = false;
                
                this.initializeElements();
                this.bindEvents();
                this.setupDateConstraints();
                this.startFloatingHearts();
            }

            initializeElements() {
                // ÁïåÈù¢ÂÖÉÁ¥†
                this.loveInfoSection = document.getElementById('loveInfoSection');
                this.photoWallContainer = document.getElementById('photoWallContainer');
                
                // ËæìÂÖ•ÂÖÉÁ¥†
                this.name1Input = document.getElementById('name1');
                this.name2Input = document.getElementById('name2');
                this.startDateInput = document.getElementById('startDate');
                this.uploadArea = document.getElementById('uploadArea');
                this.fileInput = document.getElementById('fileInput');
                this.imageCount = document.getElementById('imageCount');
                this.createWallBtn = document.getElementById('createWallBtn');
                this.demoBtn = document.getElementById('demoBtn');
                
                // ÊòæÁ§∫ÂÖÉÁ¥†
                this.displayName1 = document.getElementById('displayName1');
                this.displayName2 = document.getElementById('displayName2');
                this.daysNumber = document.getElementById('daysNumber');
                this.photoWall = document.getElementById('photoWall');
                
                // ÊéßÂà∂ÂÖÉÁ¥†
                this.resetBtn = document.getElementById('resetBtn');
                this.pauseBtn = document.getElementById('pauseBtn');
                this.speedUpBtn = document.getElementById('speedUpBtn');
                this.slowDownBtn = document.getElementById('slowDownBtn');
                this.shareBtn = document.getElementById('shareBtn');
                
                // ÊµÆÂä®Áà±ÂøÉÂÆπÂô®
                this.floatingHearts = document.getElementById('floatingHearts');
            }

            bindEvents() {
                // ÁÖßÁâá‰∏ä‰º†‰∫ã‰ª∂
                this.uploadArea.addEventListener('click', () => this.fileInput.click());
                this.fileInput.addEventListener('change', (e) => this.handleFileSelect(e));
                
                // ÊãñÊãΩ‰∏ä‰º†‰∫ã‰ª∂
                this.uploadArea.addEventListener('dragover', (e) => this.handleDragOver(e));
                this.uploadArea.addEventListener('dragleave', (e) => this.handleDragLeave(e));
                this.uploadArea.addEventListener('drop', (e) => this.handleDrop(e));
                
                // ÂàõÂª∫ÁÖßÁâáÂ¢ôÊåâÈíÆ
                this.createWallBtn.addEventListener('click', () => this.createPhotoWall());
                
                // ÊºîÁ§∫ÊåâÈíÆ
                this.demoBtn.addEventListener('click', () => this.loadDemoImages());
                
                // ËæìÂÖ•Ê°ÜÂèòÂåñ‰∫ã‰ª∂
                [this.name1Input, this.name2Input, this.startDateInput].forEach(input => {
                    input.addEventListener('input', () => this.validateInputs());
                });
                
                // ÊéßÂà∂ÊåâÈíÆ‰∫ã‰ª∂
                this.resetBtn.addEventListener('click', () => this.resetToStart());
                this.pauseBtn.addEventListener('click', () => this.togglePause());
                this.speedUpBtn.addEventListener('click', () => this.adjustSpeed(0.5));
                this.slowDownBtn.addEventListener('click', () => this.adjustSpeed(2));
                this.shareBtn.addEventListener('click', () => this.generateShareImage());
                
                // ÁÇπÂáªÊöÇÂÅúÊóãËΩ¨
                this.photoWall.addEventListener('click', () => this.togglePause());
            }

            setupDateConstraints() {
                const today = new Date().toISOString().split('T')[0];
                this.startDateInput.setAttribute('max', today);
                
                // ËÆæÁΩÆÈªòËÆ§Êó•Êúü‰∏∫‰∏ÄÂπ¥Ââç
                const oneYearAgo = new Date();
                oneYearAgo.setFullYear(oneYearAgo.getFullYear() - 1);
                this.startDateInput.value = oneYearAgo.toISOString().split('T')[0];
            }

            validateInputs() {
                const name1 = this.name1Input.value.trim();
                const name2 = this.name2Input.value.trim();
                const startDate = this.startDateInput.value;
                const hasImages = this.images.length >= 8;
                
                const isValid = name1 && name2 && startDate && hasImages;
                this.createWallBtn.disabled = !isValid;
            }

            // Êñá‰ª∂Â§ÑÁêÜÊñπÊ≥ï
            handleFileSelect(event) {
                const files = Array.from(event.target.files);
                this.processFiles(files);
            }

            handleDragOver(event) {
                event.preventDefault();
                this.uploadArea.classList.add('dragover');
            }

            handleDragLeave(event) {
                event.preventDefault();
                this.uploadArea.classList.remove('dragover');
            }

            handleDrop(event) {
                event.preventDefault();
                this.uploadArea.classList.remove('dragover');
                const files = Array.from(event.dataTransfer.files);
                this.processFiles(files);
            }

            async processFiles(files) {
                const imageFiles = files.filter(file => file.type.startsWith('image/'));
                
                if (imageFiles.length === 0) {
                    this.showNotification('ËØ∑ÈÄâÊã©ÂõæÁâáÊñá‰ª∂ÔºÅ', 'warning');
                    return;
                }

                this.showLoading();

                for (const file of imageFiles) {
                    try {
                        const imageData = await this.loadImage(file);
                        this.images.push(imageData);
                        this.updateImageCount();
                    } catch (error) {
                        console.error('Âä†ËΩΩÂõæÁâáÂ§±Ë¥•:', error);
                    }
                }

                this.hideLoading();
                this.validateInputs();

                if (this.images.length >= 8) {
                    this.showNotification(`Â§™Ê£í‰∫ÜÔºÅÂ∑≤‰∏ä‰º†${this.images.length}Âº†ÁÖßÁâá üíï`, 'success');
                } else {
                    this.showNotification(`ËøòÈúÄË¶Å${8 - this.images.length}Âº†ÁÖßÁâáÊâçËÉΩÂàõÂª∫ÁÖßÁâáÂ¢ô`, 'info');
                }
            }

            loadImage(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const img = new Image();
                        img.onload = () => {
                            resolve({
                                src: e.target.result,
                                name: file.name,
                                width: img.width,
                                height: img.height
                            });
                        };
                        img.onerror = reject;
                        img.src = e.target.result;
                    };
                    reader.onerror = reject;
                    reader.readAsDataURL(file);
                });
            }

            showLoading() {
                this.uploadArea.querySelector('.upload-content').innerHTML = `
                    <div class="loading"></div>
                    <p>Ê≠£Âú®Âä†ËΩΩÂõæÁâá...</p>
                `;
            }

            hideLoading() {
                this.uploadArea.querySelector('.upload-content').innerHTML = `
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="7,10 12,15 17,10"/>
                        <line x1="12" y1="15" x2="12" y2="3"/>
                    </svg>
                    <p>‰∏ä‰º†Êàë‰ª¨ÁöÑÁæéÂ•ΩÂõûÂøÜ</p>
                    <p class="upload-hint">ÊîØÊåÅ JPG„ÄÅPNG Ê†ºÂºèÔºåËá≥Â∞ë8Âº†ÁÖßÁâá</p>
                    <button type="button" id="demoBtn" class="demo-btn">üì∏ Âä†ËΩΩÊºîÁ§∫ÂõæÁâá</button>
                `;
                
                // ÈáçÊñ∞ÁªëÂÆöÊºîÁ§∫ÊåâÈíÆ‰∫ã‰ª∂
                const newDemoBtn = document.getElementById('demoBtn');
                if (newDemoBtn) {
                    newDemoBtn.addEventListener('click', () => this.loadDemoImages());
                }
            }

            updateImageCount() {
                this.imageCount.textContent = this.images.length;
            }

            async loadDemoImages() {
                this.showNotification('Ê≠£Âú®ÁîüÊàêÊºîÁ§∫ÂõæÁâá... üé®', 'info');
                
                const themes = [
                    { colors: ['#FF6B6B', '#4ECDC4'], name: 'Êµ∑Ê¥ãÊó•ËêΩ', emoji: 'üåÖ' },
                    { colors: ['#A8E6CF', '#FF8A80'], name: 'Êò•Êó•Ëä±Âõ≠', emoji: 'üå∏' },
                    { colors: ['#FFD93D', '#6BCF7F'], name: 'Èò≥ÂÖâËçâÂú∞', emoji: 'üåª' },
                    { colors: ['#A8EDEA', '#FED6E3'], name: 'Ê¢¶Âπª‰∫ëÂΩ©', emoji: '‚òÅÔ∏è' },
                    { colors: ['#D299C2', '#FEF9D7'], name: 'Ëñ∞Ë°£ËçâÁî∞', emoji: 'üíú' },
                    { colors: ['#89F7FE', '#66A6FF'], name: 'ËìùËâ≤Ê¢¶Â¢É', emoji: 'üíô' },
                    { colors: ['#FDA085', '#F6D365'], name: 'ÈáëÁßãÊó∂ÂÖâ', emoji: 'üçÇ' },
                    { colors: ['#F093FB', '#F5576C'], name: 'Áé´Áë∞Ëä±Áì£', emoji: 'üåπ' },
                    { colors: ['#4FACFE', '#00F2FE'], name: 'ÂÜ∞Èõ™‰∏ñÁïå', emoji: '‚ùÑÔ∏è' },
                    { colors: ['#43E97B', '#38F9D7'], name: 'Áø°Áø†Ê£ÆÊûó', emoji: 'üå≤' }
                ];

                this.images = [];
                
                for (let i = 0; i < themes.length; i++) {
                    const theme = themes[i];
                    const canvas = document.createElement('canvas');
                    canvas.width = 400;
                    canvas.height = 500;
                    const ctx = canvas.getContext('2d');
                    
                    // ÂàõÂª∫Ê∏êÂèòËÉåÊôØ
                    const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
                    gradient.addColorStop(0, theme.colors[0]);
                    gradient.addColorStop(1, theme.colors[1]);
                    
                    ctx.fillStyle = gradient;
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    
                    // Ê∑ªÂä†Ë£ÖÈ•∞ÂÖÉÁ¥†
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.2)';
                    for (let j = 0; j < 20; j++) {
                        const x = Math.random() * canvas.width;
                        const y = Math.random() * canvas.height;
                        const size = Math.random() * 50 + 20;
                        ctx.beginPath();
                        ctx.arc(x, y, size, 0, Math.PI * 2);
                        ctx.fill();
                    }
                    
                    // Ê∑ªÂä†‰∏ªÈ¢òÂõæÊ†á
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                    ctx.font = '120px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText(theme.emoji, canvas.width / 2, canvas.height / 2 + 40);
                    
                    // Ê∑ªÂä†‰∏ªÈ¢òÂêçÁß∞
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
                    ctx.font = 'bold 36px Arial';
                    ctx.fillText(theme.name, canvas.width / 2, canvas.height - 60);
                    
                    const dataURL = canvas.toDataURL('image/png');
                    this.images.push({
                        src: dataURL,
                        name: theme.name,
                        width: 400,
                        height: 500
                    });
                }
                
                this.updateImageCount();
                this.validateInputs();
                this.showNotification('ÊºîÁ§∫ÂõæÁâáÂä†ËΩΩÂÆåÊàêÔºÅ ‚ú®', 'success');
            }

            createPhotoWall() {
                const name1 = this.name1Input.value.trim();
                const name2 = this.name2Input.value.trim();
                const startDate = this.startDateInput.value;

                if (!name1 || !name2 || !startDate || this.images.length < 8) {
                    this.showNotification('ËØ∑Á°Æ‰øùÊâÄÊúâ‰ø°ÊÅØÈÉΩÂ∑≤Â°´ÂÜôÂÆåÊï¥ÔºÅ', 'warning');
                    return;
                }

                // ‰øùÂ≠òÊÅãÁà±‰ø°ÊÅØ
                this.coupleName1 = name1;
                this.coupleName2 = name2;
                this.loveStartDate = new Date(startDate);

                // ÊòæÁ§∫Âä†ËΩΩ
                this.createWallBtn.innerHTML = `
                    <div class="loading"></div>
                    <span>Ê≠£Âú®ÂàõÂª∫ÁÇ´ÈÖ∑3DÂõûÂøÜÂ¢ô...</span>
                `;
                this.createWallBtn.disabled = true;

                // Âª∂ËøüÂàáÊç¢ÁïåÈù¢
                setTimeout(() => {
                    this.showPhotoWall();
                }, 2000);
            }

            showPhotoWall() {
                // Êõ¥Êñ∞ÊÅãÁà±‰ø°ÊÅØÊòæÁ§∫
                this.displayName1.textContent = this.coupleName1;
                this.displayName2.textContent = this.coupleName2;
                
                // ËÆ°ÁÆóÂπ∂Âä®ÁîªÊòæÁ§∫ÊÅãÁà±Â§©Êï∞
                const today = new Date();
                const timeDiff = today.getTime() - this.loveStartDate.getTime();
                const daysDiff = Math.floor(timeDiff / (1000 * 3600 * 24));
                this.animateNumber(this.daysNumber, 0, daysDiff, 2000);
                
                // ÁîüÊàê3DÁÖßÁâáÂ¢ô
                this.generate3DPhotoWall();
                
                // ÂàáÊç¢ÁïåÈù¢
                this.loveInfoSection.style.display = 'none';
                this.photoWallContainer.style.display = 'block';
                this.photoWallContainer.classList.add('fade-in');
                
                // ÊòæÁ§∫ÊàêÂäüÈÄöÁü•
                this.showNotification(`üéâ ÁÇ´ÈÖ∑3DÂõûÂøÜÂ¢ôÂàõÂª∫ÊàêÂäüÔºÅÁõ∏Áà±‰∫Ü ${daysDiff} Â§©ÔºÅ`, 'success');
                
                // ÊªöÂä®Âà∞ÁÖßÁâáÂ¢ô
                this.photoWallContainer.scrollIntoView({ 
                    behavior: 'smooth',
                    block: 'start'
                });
            }

            animateNumber(element, start, end, duration) {
                const startTime = performance.now();
                const range = end - start;

                const animate = (currentTime) => {
                    const elapsed = currentTime - startTime;
                    const progress = Math.min(elapsed / duration, 1);
                    
                    const easeOutQuart = 1 - Math.pow(1 - progress, 4);
                    const currentValue = Math.floor(start + (range * easeOutQuart));
                    
                    element.textContent = currentValue;
                    
                    if (progress < 1) {
                        requestAnimationFrame(animate);
                    }
                };
                
                requestAnimationFrame(animate);
            }

            generate3DPhotoWall() {
                this.photoWall.innerHTML = '';
                
                this.showNotification(`Ê≠£Âú®ÁîüÊàêÁÇ´ÈÖ∑3DËΩÆÊí≠ÁÖßÁâáÂ¢ô - ${this.images.length}Âº†ÁÖßÁâá ‚ú®`, 'info');
                
                // ÂàõÂª∫3DËΩÆÊí≠ÂÆπÂô®
                const carousel = document.createElement('div');
                carousel.className = 'carousel-3d';
                
                // ËÆ°ÁÆóÂ∏ÉÂ±Ä
                const displayCount = Math.min(this.images.length, 8);
                const angleStep = 360 / displayCount;
                const radius = 450;
                
                for (let i = 0; i < displayCount; i++) {
                    const imageIndex = i % this.images.length;
                    const angle = i * angleStep;
                    const radian = (angle * Math.PI) / 180;
                    
                    const x = Math.sin(radian) * radius;
                    const z = Math.cos(radian) * radius;
                    
                    const card = this.createPhotoCard(this.images[imageIndex], {
                        transform: `translateZ(${z}px) translateX(${x}px) rotateY(${-angle}deg)`,
                        delay: i * 0.2
                    }, imageIndex);
                    
                    carousel.appendChild(card);
                }
                
                this.photoWall.appendChild(carousel);
                
                // Â¶ÇÊûúÂõæÁâáË∂ÖËøá8Âº†ÔºåÂàõÂª∫ËΩÆÊç¢Êú∫Âà∂
                if (this.images.length > 8) {
                    this.setupImageRotation(carousel, displayCount);
                }
                
                setTimeout(() => {
                    this.showNotification(`ÁÇ´ÈÖ∑3DËΩÆÊí≠ÁÖßÁâáÂ¢ôÁîüÊàêÂÆåÊàêÔºÅüéâ`, 'success');
                }, 1500);
            }

            createPhotoCard(image, layout, index) {
                const card = document.createElement('div');
                card.className = 'card-3d';
                card.style.transform = layout.transform;
                card.style.opacity = '0';
                
                const img = document.createElement('img');
                img.src = image.src;
                img.alt = image.name;
                img.loading = 'lazy';
                
                // Ê∑ªÂä†Âç°Áâá‰ø°ÊÅØ
                const cardInfo = document.createElement('div');
                cardInfo.className = 'card-info';
                cardInfo.innerHTML = `
                    <h3>${image.name}</h3>
                    <p>Á¨¨ ${index + 1} Âº†ÁÖßÁâá ¬∑ Êàë‰ª¨ÁöÑÁæéÂ•ΩÂõûÂøÜ</p>
                `;
                
                // Âª∂ËøüÊòæÁ§∫Âä®Áîª
                const delay = Math.min((layout.delay || 0), 1.6);
                setTimeout(() => {
                    card.style.transition = 'opacity 1s cubic-bezier(0.25, 0.46, 0.45, 0.94), transform 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
                    card.style.opacity = '1';
                }, delay * 300);
                
                // ÁÇπÂáª‰∫ã‰ª∂
                card.addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.showImageModal(image);
                });
                
                card.appendChild(img);
                card.appendChild(cardInfo);
                return card;
            }

            setupImageRotation(carousel, displayCount) {
                let currentOffset = 0;
                
                this.imageRotationInterval = setInterval(() => {
                    if (this.photoWallContainer.style.display === 'none') return;
                    if (this.isPaused) return;
                    
                    currentOffset = (currentOffset + 1) % this.images.length;
                    
                    // Êõ¥Êñ∞ÊØèÂº†Âç°ÁâáÁöÑÂõæÁâá
                    const cards = carousel.querySelectorAll('.card-3d');
                    cards.forEach((card, index) => {
                        const imageIndex = (currentOffset + index) % this.images.length;
                        const img = card.querySelector('img');
                        const info = card.querySelector('.card-info');
                        
                        if (img && this.images[imageIndex]) {
                            img.style.opacity = '0';
                            setTimeout(() => {
                                img.src = this.images[imageIndex].src;
                                img.alt = this.images[imageIndex].name;
                                info.innerHTML = `
                                    <h3>${this.images[imageIndex].name}</h3>
                                    <p>Á¨¨ ${imageIndex + 1} Âº†ÁÖßÁâá ¬∑ Êàë‰ª¨ÁöÑÁæéÂ•ΩÂõûÂøÜ</p>
                                `;
                                img.style.opacity = '1';
                            }, 200);
                        }
                    });
                }, 5000);
            }

            showImageModal(image) {
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.9);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 10000;
                    cursor: pointer;
                    backdrop-filter: blur(15px);
                `;
                
                const img = document.createElement('img');
                img.src = image.src;
                img.style.cssText = `
                    max-width: 90%;
                    max-height: 90%;
                    object-fit: contain;
                    border-radius: 20px;
                    box-shadow: 0 30px 100px rgba(0, 0, 0, 0.8);
                    animation: modalZoomIn 0.5s ease;
                `;
                
                // Ê∑ªÂä†Ê®°ÊÄÅÊ°ÜÂä®Áîª
                const style = document.createElement('style');
                style.textContent = `
                    @keyframes modalZoomIn {
                        from {
                            opacity: 0;
                            transform: scale(0.5);
                        }
                        to {
                            opacity: 1;
                            transform: scale(1);
                        }
                    }
                `;
                document.head.appendChild(style);
                
                modal.appendChild(img);
                document.body.appendChild(modal);
                
                modal.addEventListener('click', () => {
                    document.body.removeChild(modal);
                    document.head.removeChild(style);
                });
            }

            // ÊéßÂà∂ÂäüËÉΩ
            togglePause() {
                this.isPaused = !this.isPaused;
                const carousel = this.photoWall.querySelector('.carousel-3d');
                
                if (this.isPaused) {
                    this.pauseBtn.textContent = '‚ñ∂Ô∏è ÁªßÁª≠ÊóãËΩ¨';
                    if (carousel) {
                        carousel.style.animationPlayState = 'paused';
                    }
                    this.showNotification('Â∑≤ÊöÇÂÅúÊóãËΩ¨ ‚è∏Ô∏è', 'info');
                } else {
                    this.pauseBtn.textContent = '‚è∏Ô∏è ÊöÇÂÅúÊóãËΩ¨';
                    if (carousel) {
                        carousel.style.animationPlayState = 'running';
                    }
                    this.showNotification('ÁªßÁª≠ÊóãËΩ¨ ‚ñ∂Ô∏è', 'info');
                }
            }

            adjustSpeed(factor) {
                this.animationSpeed *= factor;
                this.animationSpeed = Math.max(0.5, Math.min(this.animationSpeed, 3));
                
                const carousel = this.photoWall.querySelector('.carousel-3d');
                if (carousel) {
                    const duration = 25 / this.animationSpeed;
                    carousel.style.animationDuration = `${duration}s`;
                }
                
                const speedText = this.animationSpeed > 1 ? 'Âä†ÈÄü' : this.animationSpeed < 1 ? 'ÂáèÈÄü' : 'Ê≠£Â∏∏';
                this.showNotification(`ÊóãËΩ¨ÈÄüÂ∫¶: ${speedText} ${factor < 1 ? '‚ö°' : 'üêå'}`, 'info');
            }

            async generateShareImage() {
                // ÂÖàËÆ©Áî®Êà∑ÈÄâÊã©Ë¶ÅÂ±ïÁ§∫ÁöÑÁÖßÁâá
                if (this.images.length > 0) {
                    this.showPhotoSelectionModal();
                } else {
                    this.createShareImageWithPhoto(null);
                }
            }
            
            showPhotoSelectionModal() {
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.85);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 10000;
                    backdrop-filter: blur(15px);
                `;
                
                const modalContent = document.createElement('div');
                modalContent.style.cssText = `
                    background: white;
                    border-radius: 30px;
                    padding: 40px;
                    max-width: 650px;
                    width: 95%;
                    max-height: 85vh;
                    overflow-y: auto;
                    box-shadow: 0 30px 100px rgba(0, 0, 0, 0.6);
                    text-align: center;
                `;
                
                modalContent.innerHTML = `
                    <h3 style="color: #ff1744; font-size: 1.6rem; font-weight: 700; margin-bottom: 20px;">üíï ÈÄâÊã©‰∏ÄÂº†ÊúÄÂñúÊ¨¢ÁöÑÁÖßÁâá</h3>
                    <p style="color: #666; margin-bottom: 30px;">ËøôÂº†ÁÖßÁâáÂ∞Ü‰Ωú‰∏∫ÂàÜ‰∫´ÂõæÁöÑ‰∏ªË¶ÅÂ±ïÁ§∫ÂõæÁâá</p>
                    <div id="photoGrid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px; margin-bottom: 30px;"></div>
                    <div style="display: flex; gap: 15px; justify-content: center;">
                        <button id="skipPhotoBtn" style="padding: 12px 25px; border: 2px solid #ddd; border-radius: 25px; background: white; color: #666; cursor: pointer; font-weight: 600;">Ë∑≥ËøáÈÄâÊã©</button>
                        <button id="cancelSelectionBtn" style="padding: 12px 25px; border: 2px solid #ff69b4; border-radius: 25px; background: white; color: #ff69b4; cursor: pointer; font-weight: 600;">ÂèñÊ∂à</button>
                    </div>
                `;
                
                const photoGrid = modalContent.querySelector('#photoGrid');
                
                // Ê∑ªÂä†ÁÖßÁâáÈÄâÈ°π
                this.images.forEach((image, index) => {
                    const photoOption = document.createElement('div');
                    photoOption.style.cssText = `
                        cursor: pointer;
                        border: 3px solid transparent;
                        border-radius: 15px;
                        overflow: hidden;
                        transition: all 0.3s ease;
                        background: white;
                        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
                    `;
                    
                    photoOption.innerHTML = `
                        <img src="${image.src}" style="width: 100%; height: 120px; object-fit: cover; display: block;">
                        <p style="padding: 8px; font-size: 0.9rem; color: #666; margin: 0;">${image.name}</p>
                    `;
                    
                    photoOption.addEventListener('click', () => {
                        document.body.removeChild(modal);
                        this.createShareImageWithPhoto(image);
                    });
                    
                    photoOption.addEventListener('mouseenter', () => {
                        photoOption.style.borderColor = '#ff69b4';
                        photoOption.style.transform = 'translateY(-5px)';
                        photoOption.style.boxShadow = '0 10px 25px rgba(255, 105, 180, 0.3)';
                    });
                    
                    photoOption.addEventListener('mouseleave', () => {
                        photoOption.style.borderColor = 'transparent';
                        photoOption.style.transform = 'translateY(0)';
                        photoOption.style.boxShadow = '0 5px 15px rgba(0, 0, 0, 0.1)';
                    });
                    
                    photoGrid.appendChild(photoOption);
                });
                
                // ‰∫ã‰ª∂ÁõëÂê¨
                modalContent.querySelector('#skipPhotoBtn').addEventListener('click', () => {
                    document.body.removeChild(modal);
                    this.createShareImageWithPhoto(null);
                });
                
                modalContent.querySelector('#cancelSelectionBtn').addEventListener('click', () => {
                    document.body.removeChild(modal);
                });
                
                modal.appendChild(modalContent);
                document.body.appendChild(modal);
            }
            
            async createShareImageWithPhoto(selectedPhoto) {
                this.showNotification('Ê≠£Âú®ÁîüÊàêÊµ™Êº´Á∫™ÂøµÂõæÁâá... üé®', 'info');
                
                // ÂàõÂª∫ÂàÜ‰∫´ÁîªÂ∏É
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                // ËÆæÁΩÆÁîªÂ∏ÉÂ∞∫ÂØ∏ÔºàÈÄÇÂêàÊúãÂèãÂúàÂàÜ‰∫´Ôºâ
                canvas.width = 800;
                canvas.height = 1200;
                
                // ÂàõÂª∫‰ºòÁæéÁöÑÊ∏êÂèòËÉåÊôØ
                const bgGradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
                bgGradient.addColorStop(0, '#ff9a9e');
                bgGradient.addColorStop(0.5, '#fecfef');
                bgGradient.addColorStop(1, '#ffd1dc');
                
                ctx.fillStyle = bgGradient;
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Ê∑ªÂä†ÁªÜËÖªÁöÑË£ÖÈ•∞ÂÖÉÁ¥†
                this.addEnhancedDecorations(ctx, canvas);
                
                // È°∂ÈÉ®Âå∫Âüü - Ê†áÈ¢òÂíåÂêçÂ≠ó (0-300px)
                this.drawTopSection(ctx, canvas);
                
                // ‰∏≠Èó¥Âå∫Âüü - ‰∏ªÁÖßÁâá (300-800px)
                if (selectedPhoto) {
                    await this.drawMainPhoto(ctx, canvas, selectedPhoto);
                } else {
                    this.drawNoPhotoSection(ctx, canvas);
                }
                
                // Â∫ïÈÉ®Âå∫Âüü - Â§©Êï∞Âíå‰ø°ÊÅØ (800-1200px)
                this.drawBottomSection(ctx, canvas);
                
                // ÊòæÁ§∫ÂàÜ‰∫´Ê®°ÊÄÅÊ°Ü
                this.showShareModal(canvas);
            }

            addEnhancedDecorations(ctx, canvas) {
                // Ê∑ªÂä†Á≤æÁæéÁöÑË£ÖÈ•∞ÂÖÉÁ¥†
                ctx.fillStyle = 'rgba(255, 255, 255, 0.08)';
                
                // Â§ßÂúÜÂúàË£ÖÈ•∞
                for (let i = 0; i < 8; i++) {
                    const x = Math.random() * canvas.width;
                    const y = Math.random() * canvas.height;
                    const radius = Math.random() * 60 + 40;
                    ctx.beginPath();
                    ctx.arc(x, y, radius, 0, Math.PI * 2);
                    ctx.fill();
                }
                
                // Â∞èÂúÜÁÇπË£ÖÈ•∞
                ctx.fillStyle = 'rgba(255, 255, 255, 0.15)';
                for (let i = 0; i < 20; i++) {
                    const x = Math.random() * canvas.width;
                    const y = Math.random() * canvas.height;
                    const radius = Math.random() * 8 + 3;
                    ctx.beginPath();
                    ctx.arc(x, y, radius, 0, Math.PI * 2);
                    ctx.fill();
                }
                
                // Áà±ÂøÉË£ÖÈ•∞
                const hearts = ['üíï', 'üíñ', 'üíó', 'üíò'];
                ctx.font = '20px Arial';
                
                for (let i = 0; i < 8; i++) {
                    const x = Math.random() * canvas.width;
                    const y = Math.random() * canvas.height;
                    const heart = hearts[Math.floor(Math.random() * hearts.length)];
                    
                    ctx.fillStyle = 'rgba(255, 182, 193, 0.3)';
                    ctx.fillText(heart, x, y);
                }
            }
            
            drawTopSection(ctx, canvas) {
                // ‰∏ªÊ†áÈ¢ò
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 40px "PingFang SC", "Microsoft YaHei", sans-serif';
                ctx.textAlign = 'center';
                ctx.shadowColor = 'rgba(255, 105, 180, 0.3)';
                ctx.shadowBlur = 10;
                ctx.fillText('üíï Êàë‰ª¨ÁöÑÁà±ÊÉÖÁ∫™ÂøµÊó•', canvas.width / 2, 80);
                
                // ÈáçÁΩÆÈò¥ÂΩ±
                ctx.shadowColor = 'transparent';
                ctx.shadowBlur = 0;
                
                // ÊÉÖ‰æ£ÂêçÂ≠óËÉåÊôØ
                const namesBg = canvas.width * 0.8;
                const namesBgHeight = 100;
                const namesBgY = 120;
                
                ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
                this.drawRoundRect(ctx, (canvas.width - namesBg) / 2, namesBgY, namesBg, namesBgHeight, 50);
                
                // ÊÉÖ‰æ£ÂêçÂ≠ó
                ctx.font = 'bold 36px "PingFang SC", "Microsoft YaHei", sans-serif';
                ctx.fillStyle = '#ff1744';
                ctx.textAlign = 'center';
                
                const namesY = namesBgY + namesBgHeight / 2 + 15;
                const name1X = canvas.width / 2 - 60;
                const name2X = canvas.width / 2 + 60;
                
                ctx.fillText(this.coupleName1, name1X, namesY);
                ctx.fillText(this.coupleName2, name2X, namesY);
                
                // ‰∏≠Èó¥Áà±ÂøÉ
                ctx.fillStyle = '#ff1744';
                ctx.font = 'bold 40px Arial';
                ctx.fillText('‚ô•', canvas.width / 2, namesY);
            }
            
            async drawMainPhoto(ctx, canvas, photo) {
                // ÁÖßÁâáÂå∫Âüü
                const photoAreaY = 300;
                const photoAreaHeight = 500;
                const photoSize = 320;
                const photoX = (canvas.width - photoSize) / 2;
                const photoY = photoAreaY + (photoAreaHeight - photoSize) / 2;
                
                // ÁÖßÁâáËÉåÊôØË£ÖÈ•∞
                ctx.fillStyle = 'rgba(255, 255, 255, 0.95)';
                const bgPadding = 40;
                this.drawRoundRect(ctx, photoX - bgPadding, photoY - bgPadding, photoSize + bgPadding * 2, photoSize + bgPadding * 2, 25);
                
                // ÁªòÂà∂ÁÖßÁâá
                try {
                    const img = new Image();
                    img.crossOrigin = 'anonymous';
                    img.src = photo.src;
                    
                    if (img.complete) {
                        ctx.save();
                        this.clipRoundRect(ctx, photoX, photoY, photoSize, photoSize, 20);
                        ctx.drawImage(img, photoX, photoY, photoSize, photoSize);
                        ctx.restore();
                    } else {
                        // Â¶ÇÊûúÂõæÁâáÊú™Âä†ËΩΩÂÆåÊàêÔºåÊòæÁ§∫Âç†‰ΩçÁ¨¶
                        ctx.fillStyle = 'rgba(255, 182, 193, 0.3)';
                        this.drawRoundRect(ctx, photoX, photoY, photoSize, photoSize, 20);
                        
                        ctx.fillStyle = '#ff69b4';
                        ctx.font = '60px Arial';
                        ctx.textAlign = 'center';
                        ctx.fillText('üì∑', photoX + photoSize / 2, photoY + photoSize / 2 + 20);
                    }
                } catch (error) {
                    // ÁªòÂà∂Âç†‰ΩçÁ¨¶
                    ctx.fillStyle = 'rgba(255, 182, 193, 0.3)';
                    this.drawRoundRect(ctx, photoX, photoY, photoSize, photoSize, 20);
                    
                    ctx.fillStyle = '#ff69b4';
                    ctx.font = '60px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('üì∑', photoX + photoSize / 2, photoY + photoSize / 2 + 20);
                }
                
                // ÁÖßÁâáÊèèËø∞
                ctx.fillStyle = '#666';
                ctx.font = 'italic 18px "PingFang SC", "Microsoft YaHei", sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('Êàë‰ª¨ÊúÄÁèçË¥µÁöÑÂõûÂøÜ', canvas.width / 2, photoY + photoSize + 60);
            }
            
            drawNoPhotoSection(ctx, canvas) {
                // Êó†ÁÖßÁâáÊó∂ÁöÑË£ÖÈ•∞Âå∫Âüü
                const decorY = 350;
                const decorHeight = 400;
                
                // Ë£ÖÈ•∞ËÉåÊôØ
                ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';
                this.drawRoundRect(ctx, 100, decorY, canvas.width - 200, decorHeight, 30);
                
                // Ë£ÖÈ•∞ÊñáÂ≠ó
                ctx.fillStyle = '#ff69b4';
                ctx.font = 'bold 36px "PingFang SC", "Microsoft YaHei", sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('üíù', canvas.width / 2, decorY + 100);
                
                ctx.fillStyle = '#888';
                ctx.font = 'italic 24px "PingFang SC", "Microsoft YaHei", sans-serif';
                ctx.fillText('ÊØè‰∏ÄÂ§©ÈÉΩÊòØÁà±ÁöÑËßÅËØÅ', canvas.width / 2, decorY + 150);
                
                // Â§ö‰∏™Â∞èÁà±ÂøÉË£ÖÈ•∞
                const hearts = ['üíï', 'üíñ', 'üíó', 'üíò', 'üíù', 'üíû'];
                ctx.font = '32px Arial';
                for (let i = 0; i < 6; i++) {
                    const angle = (i / 6) * Math.PI * 2;
                    const radius = 80;
                    const x = canvas.width / 2 + Math.cos(angle) * radius;
                    const y = decorY + 250 + Math.sin(angle) * radius;
                    
                    ctx.fillStyle = 'rgba(255, 105, 180, 0.7)';
                    ctx.fillText(hearts[i], x, y);
                }
            }
            
            drawBottomSection(ctx, canvas) {
                const bottomY = 850;
                
                // Â§©Êï∞ÊòæÁ§∫ËÉåÊôØ
                ctx.fillStyle = 'rgba(255, 255, 255, 0.95)';
                this.drawRoundRect(ctx, 50, bottomY, canvas.width - 100, 250, 25);
                
                // ËÆ°ÁÆóÊÅãÁà±Â§©Êï∞
                const today = new Date();
                const timeDiff = today.getTime() - this.loveStartDate.getTime();
                const daysDiff = Math.floor(timeDiff / (1000 * 3600 * 24));
                
                // Â§©Êï∞Ê†áÈ¢ò
                ctx.fillStyle = '#666';
                ctx.font = 'bold 24px "PingFang SC", "Microsoft YaHei", sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('Êàë‰ª¨Â∑≤ÁªèÁõ∏Áà±‰∫Ü', canvas.width / 2, bottomY + 50);
                
                // Â§ßÊï∞Â≠óÂ§©Êï∞
                ctx.fillStyle = '#ff1744';
                ctx.font = 'bold 80px "PingFang SC", "Microsoft YaHei", sans-serif';
                ctx.shadowColor = 'rgba(255, 105, 180, 0.4)';
                ctx.shadowBlur = 15;
                ctx.fillText(daysDiff, canvas.width / 2, bottomY + 140);
                
                ctx.shadowColor = 'transparent';
                ctx.shadowBlur = 0;
                
                // Â§©Êï∞Âçï‰Ωç
                ctx.fillStyle = '#ff69b4';
                ctx.font = 'bold 28px "PingFang SC", "Microsoft YaHei", sans-serif';
                ctx.fillText('Â§©', canvas.width / 2, bottomY + 180);
                
                // Êó•ÊúüËåÉÂõ¥
                const startDateStr = this.loveStartDate.toLocaleDateString('zh-CN');
                const todayStr = today.toLocaleDateString('zh-CN');
                
                ctx.fillStyle = '#888';
                ctx.font = '18px "PingFang SC", "Microsoft YaHei", sans-serif';
                ctx.fillText(`${startDateStr} - ${todayStr}`, canvas.width / 2, bottomY + 220);
                
                // Â∫ïÈÉ®Êµ™Êº´ËØ≠ÂΩï
                const romanticQuotes = [
                    '"‰∏é‰Ω†Áõ∏ÈÅáÔºåÂ•ΩÂπ∏Ëøê"',
                    '"Áà±‰Ω†ÊòØÊàëÂÅöËøáÊúÄÂ•ΩÁöÑÂÜ≥ÂÆö"',
                    '"‰Ω†ÊòØÊàë‰ªäÁîüÂîØ‰∏ÄÁöÑÁ≠îÊ°à"',
                    '"‰∏é‰Ω†Âú®‰∏ÄËµ∑ÔºåÊó∂ÂÖâÈÉΩÂèòÂæóÊ∏©Êüî"'
                ];
                
                const randomQuote = romanticQuotes[Math.floor(Math.random() * romanticQuotes.length)];
                
                ctx.fillStyle = '#999';
                ctx.font = 'italic 20px "PingFang SC", "Microsoft YaHei", sans-serif';
                ctx.fillText(randomQuote, canvas.width / 2, canvas.height - 80);
                
                // ÁîüÊàêÊó∂Èó¥
                ctx.fillStyle = '#bbb';
                ctx.font = '16px "PingFang SC", "Microsoft YaHei", sans-serif';
                const generateTime = new Date().toLocaleDateString('zh-CN');
                ctx.fillText(`ÁîüÊàê‰∫é ${generateTime} ¬∑ Áà±ÊÉÖÁ∫™ÂøµÂÜå`, canvas.width / 2, canvas.height - 40);
            }

            addRomanticDecorations(ctx, canvas) {
                // Ê∑ªÂä†Êµ™Êº´Ë£ÖÈ•∞ÂÖÉÁ¥†
                ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
                
                // Ê∑ªÂä†ÈöèÊú∫ÂúÜÂúàË£ÖÈ•∞
                for (let i = 0; i < 25; i++) {
                    const x = Math.random() * canvas.width;
                    const y = Math.random() * canvas.height;
                    const radius = Math.random() * 40 + 20;
                    ctx.beginPath();
                    ctx.arc(x, y, radius, 0, Math.PI * 2);
                    ctx.fill();
                }
                
                // Ê∑ªÂä†Áà±ÂøÉË£ÖÈ•∞
                const hearts = ['üíï', 'üíñ', 'üíó', 'üíò', 'üíù', 'üíû', 'üíü', '‚ù§Ô∏è'];
                ctx.font = '30px Arial';
                
                for (let i = 0; i < 15; i++) {
                    const x = Math.random() * canvas.width;
                    const y = Math.random() * canvas.height;
                    const heart = hearts[Math.floor(Math.random() * hearts.length)];
                    
                    ctx.fillStyle = 'rgba(255, 182, 193, 0.6)';
                    ctx.fillText(heart, x, y);
                }
            }
            
            async addPhotoGrid(ctx, canvas) {
                // Âú®‰∏≠Èó¥Âå∫ÂüüÊ∑ªÂä†ÁÖßÁâáÁΩëÊ†º
                const gridStartY = 580;
                const gridHeight = 350;
                const photoSize = 80;
                const spacing = 20;
                const cols = 6;
                const rows = 3;
                
                const gridWidth = cols * photoSize + (cols - 1) * spacing;
                const startX = (canvas.width - gridWidth) / 2;
                
                // ÁªòÂà∂ÁΩëÊ†ºËÉåÊôØ
                ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
                this.drawRoundRect(ctx, startX - 20, gridStartY - 20, gridWidth + 40, gridHeight + 40, 15);
                
                // ÁªòÂà∂ÁÖßÁâáÂç†‰ΩçÁ¨¶
                for (let row = 0; row < rows; row++) {
                    for (let col = 0; col < cols; col++) {
                        const index = row * cols + col;
                        if (index >= Math.min(this.images.length, 18)) break;
                        
                        const x = startX + col * (photoSize + spacing);
                        const y = gridStartY + row * (photoSize + spacing);
                        
                        // ÁªòÂà∂Áõ∏Ê°Ü
                        ctx.fillStyle = 'rgba(255, 182, 193, 0.3)';
                        ctx.strokeStyle = '#ff69b4';
                        ctx.lineWidth = 2;
                        
                        this.drawRoundRect(ctx, x, y, photoSize, photoSize, 8);
                        ctx.stroke();
                        
                        // ÁªòÂà∂ÁÖßÁâáÂç†‰ΩçÁ¨¶ÂõæÊ†á
                        ctx.fillStyle = '#ff69b4';
                        ctx.font = '24px Arial';
                        ctx.textAlign = 'center';
                        ctx.fillText('üì∑', x + photoSize / 2, y + photoSize / 2 + 8);
                    }
                }
                
                // Ê∑ªÂä†ÁÖßÁâáÂå∫ÂüüÊ†áÈ¢ò
                ctx.font = 'bold 20px "PingFang SC", "Microsoft YaHei", sans-serif';
                ctx.fillStyle = '#666';
                ctx.textAlign = 'center';
                ctx.fillText(`Êàë‰ª¨ÁöÑ ${this.images.length} Âº†ÁæéÂ•ΩÂõûÂøÜ`, canvas.width / 2, gridStartY - 30);
            }
            
            showShareModal(canvas) {
                // ÂàõÂª∫Ê®°ÊÄÅÊ°Ü
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.85);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 10000;
                    backdrop-filter: blur(15px);
                    animation: modalFadeIn 0.4s ease;
                `;
                
                const modalContent = document.createElement('div');
                modalContent.style.cssText = `
                    background: white;
                    border-radius: 30px;
                    padding: 40px;
                    max-width: 550px;
                    width: 95%;
                    max-height: 85vh;
                    overflow-y: auto;
                    box-shadow: 0 30px 100px rgba(0, 0, 0, 0.6);
                    animation: modalSlideIn 0.5s ease;
                    text-align: center;
                `;
                
                // Ê∑ªÂä†Ê®°ÊÄÅÊ°ÜÂÜÖÂÆπ
                modalContent.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                        <h3 style="color: #ff1744; font-size: 1.6rem; font-weight: 700; margin: 0;">üíï ÂàÜ‰∫´Êàë‰ª¨ÁöÑÁà±ÊÉÖ</h3>
                        <button id="closeShareModal" style="background: none; border: none; font-size: 2rem; cursor: pointer; color: #999; padding: 5px;">√ó</button>
                    </div>
                    <div style="margin-bottom: 30px;">
                        <img id="sharePreview" style="max-width: 100%; border-radius: 20px; box-shadow: 0 20px 60px rgba(255, 105, 180, 0.4);" />
                    </div>
                    <div style="display: flex; gap: 20px; justify-content: center; flex-wrap: wrap;">
                        <button id="downloadShare" style="padding: 15px 30px; border: none; border-radius: 25px; font-size: 1.1rem; cursor: pointer; transition: all 0.3s ease; font-weight: 600; display: flex; align-items: center; gap: 10px; background: linear-gradient(135deg, #ff6b9d, #ff1744); color: white; box-shadow: 0 10px 30px rgba(255, 105, 180, 0.4);">
                            üì• ‰∏ãËΩΩÂõæÁâá
                        </button>
                        <button id="copyShare" style="padding: 15px 30px; border: 2px solid rgba(255, 182, 193, 0.6); border-radius: 25px; font-size: 1.1rem; cursor: pointer; transition: all 0.3s ease; font-weight: 600; display: flex; align-items: center; gap: 10px; background: rgba(255, 182, 193, 0.4); color: #ff1744;">
                            üìã Â§çÂà∂ÂõæÁâá
                        </button>
                    </div>
                `;
                
                // ÊòæÁ§∫È¢ÑËßàÂõæ
                const sharePreview = modalContent.querySelector('#sharePreview');
                sharePreview.src = canvas.toDataURL('image/png');
                
                modal.appendChild(modalContent);
                document.body.appendChild(modal);
                
                // Ê∑ªÂä†‰∫ã‰ª∂ÁõëÂê¨
                modalContent.querySelector('#closeShareModal').addEventListener('click', () => {
                    document.body.removeChild(modal);
                });
                
                modalContent.querySelector('#downloadShare').addEventListener('click', () => {
                    this.downloadShareImage(canvas);
                });
                
                modalContent.querySelector('#copyShare').addEventListener('click', () => {
                    this.copyShareImage(canvas);
                });
                
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        document.body.removeChild(modal);
                    }
                });
                
                // Ê∑ªÂä†Ê®°ÊÄÅÊ°ÜÂä®Áîª
                const style = document.createElement('style');
                style.textContent = `
                    @keyframes modalFadeIn {
                        from { opacity: 0; }
                        to { opacity: 1; }
                    }
                    @keyframes modalSlideIn {
                        from {
                            opacity: 0;
                            transform: scale(0.8) translateY(50px);
                        }
                        to {
                            opacity: 1;
                            transform: scale(1) translateY(0);
                        }
                    }
                `;
                document.head.appendChild(style);
                
                this.showNotification('Êµ™Êº´Á∫™ÂøµÂõæÁâáÁîüÊàêÂÆåÊàêÔºÅüíï', 'success');
            }
            
            downloadShareImage(canvas) {
                const dataURL = canvas.toDataURL('image/png');
                const link = document.createElement('a');
                const fileName = `${this.coupleName1}Âíå${this.coupleName2}ÁöÑÁà±ÊÉÖÁ∫™Âøµ_${new Date().toLocaleDateString('zh-CN').replace(/\//g, '-')}.png`;
                link.download = fileName;
                link.href = dataURL;
                link.click();
                
                this.showNotification('ÂõæÁâá‰∏ãËΩΩÊàêÂäüÔºÅüì•', 'success');
            }
            
            async copyShareImage(canvas) {
                try {
                    canvas.toBlob(async (blob) => {
                        try {
                            await navigator.clipboard.write([
                                new ClipboardItem({ 'image/png': blob })
                            ]);
                            this.showNotification('ÂõæÁâáÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥ÊùøÔºÅüìã', 'success');
                        } catch (error) {
                            this.fallbackCopyText();
                        }
                    });
                } catch (error) {
                    this.fallbackCopyText();
                }
            }
            
            fallbackCopyText() {
                const today = new Date();
                const timeDiff = today.getTime() - this.loveStartDate.getTime();
                const daysDiff = Math.floor(timeDiff / (1000 * 3600 * 24));
                
                const shareText = `üíï ${this.coupleName1} & ${this.coupleName2} ÁöÑÁà±ÊÉÖÁ∫™ÂøµÊó•\n\nÊàë‰ª¨Â∑≤ÁªèÁõ∏Áà±‰∫Ü ${daysDiff} Â§©ÔºÅ\n\n‰∏é‰Ω†Áõ∏ÈÅáÔºåÂ•ΩÂπ∏Ëøê ‚ù§Ô∏è\n\n#Áà±ÊÉÖÁ∫™Âøµ #ÁîúËúúÊó∂ÂÖâ #${daysDiff}Â§©`;
                
                if (navigator.clipboard) {
                    navigator.clipboard.writeText(shareText).then(() => {
                        this.showNotification('ÊñáÊú¨Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥ÊùøÔºÅüìã', 'success');
                    }).catch(() => {
                        this.showNotification('Â§çÂà∂Â§±Ë¥•ÔºåËØ∑ÊâãÂä®Êà™ÂõæÂàÜ‰∫´', 'warning');
                    });
                } else {
                    this.showNotification('Â§çÂà∂Â§±Ë¥•ÔºåËØ∑ÊâãÂä®Êà™ÂõæÂàÜ‰∫´', 'warning');
                }
            }
            
            drawRoundRect(ctx, x, y, width, height, radius) {
                ctx.beginPath();
                ctx.moveTo(x + radius, y);
                ctx.lineTo(x + width - radius, y);
                ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
                ctx.lineTo(x + width, y + height - radius);
                ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
                ctx.lineTo(x + radius, y + height);
                ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
                ctx.lineTo(x, y + radius);
                ctx.quadraticCurveTo(x, y, x + radius, y);
                ctx.closePath();
                ctx.fill();
            }
            
            clipRoundRect(ctx, x, y, width, height, radius) {
                ctx.beginPath();
                ctx.moveTo(x + radius, y);
                ctx.lineTo(x + width - radius, y);
                ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
                ctx.lineTo(x + width, y + height - radius);
                ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
                ctx.lineTo(x + radius, y + height);
                ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
                ctx.lineTo(x, y + radius);
                ctx.quadraticCurveTo(x, y, x + radius, y);
                ctx.closePath();
                ctx.clip();
            }

            resetToStart() {
                // Ê∏ÖÁêÜÂÆöÊó∂Âô®
                if (this.imageRotationInterval) {
                    clearInterval(this.imageRotationInterval);
                }
                
                this.images = [];
                this.updateImageCount();
                this.photoWallContainer.style.display = 'none';
                this.loveInfoSection.style.display = 'block';
                this.loveInfoSection.classList.add('fade-in');
                
                // ÈáçÁΩÆËæìÂÖ•
                this.name1Input.value = '';
                this.name2Input.value = '';
                this.fileInput.value = '';
                
                // ÈáçÁΩÆÊó•Êúü
                const oneYearAgo = new Date();
                oneYearAgo.setFullYear(oneYearAgo.getFullYear() - 1);
                this.startDateInput.value = oneYearAgo.toISOString().split('T')[0];
                
                // ÈáçÁΩÆÊåâÈíÆÁä∂ÊÄÅ
                this.createWallBtn.innerHTML = `
                    <span>üíñ</span>
                    <span>ÂàõÂª∫Êàë‰ª¨ÁöÑ3DÂõûÂøÜÂ¢ô</span>
                    <span>üíñ</span>
                `;
                this.createWallBtn.disabled = true;
                this.pauseBtn.textContent = '‚è∏Ô∏è ÊöÇÂÅúÊóãËΩ¨';
                this.isPaused = false;
                this.animationSpeed = 1;
                
                this.validateInputs();
                this.showNotification('Â∑≤ÈáçÁΩÆÔºåÂèØ‰ª•ÈáçÊñ∞ÂºÄÂßãÂï¶ üîÑ', 'info');
                
                // ÊªöÂä®Âà∞È°∂ÈÉ®
                this.loveInfoSection.scrollIntoView({ 
                    behavior: 'smooth',
                    block: 'start'
                });
            }

            startFloatingHearts() {
                setInterval(() => {
                    this.createFloatingHeart();
                }, 3000);
            }

            createFloatingHeart() {
                const hearts = ['üíï', 'üíñ', 'üíó', 'üíò', 'üíù', 'üíû', 'üíü', '‚ù§Ô∏è'];
                const heart = document.createElement('div');
                heart.className = 'floating-heart';
                heart.innerHTML = hearts[Math.floor(Math.random() * hearts.length)];
                heart.style.left = Math.random() * 100 + 'vw';
                heart.style.animationDuration = (Math.random() * 4 + 6) + 's';
                heart.style.fontSize = (Math.random() * 1 + 1.5) + 'rem';
                
                this.floatingHearts.appendChild(heart);
                
                setTimeout(() => {
                    if (heart.parentNode) {
                        heart.parentNode.removeChild(heart);
                    }
                }, 10000);
            }

            showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    padding: 15px 25px;
                    border-radius: 25px;
                    font-size: 1rem;
                    font-weight: 600;
                    z-index: 10000;
                    backdrop-filter: blur(15px);
                    animation: slideInOut 4s ease forwards;
                    box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
                `;
                
                // Ê∑ªÂä†Âä®Áîª
                const style = document.createElement('style');
                style.textContent = `
                    @keyframes slideInOut {
                        0% {
                            transform: translateX(100%);
                            opacity: 0;
                        }
                        15%, 85% {
                            transform: translateX(0);
                            opacity: 1;
                        }
                        100% {
                            transform: translateX(100%);
                            opacity: 0;
                        }
                    }
                `;
                document.head.appendChild(style);
                
                switch (type) {
                    case 'success':
                        notification.style.background = 'rgba(76, 175, 80, 0.95)';
                        notification.style.color = 'white';
                        break;
                    case 'warning':
                        notification.style.background = 'rgba(255, 152, 0, 0.95)';
                        notification.style.color = 'white';
                        break;
                    default:
                        notification.style.background = 'rgba(255, 105, 180, 0.95)';
                        notification.style.color = 'white';
                }
                
                notification.textContent = message;
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                    if (style.parentNode) {
                        style.parentNode.removeChild(style);
                    }
                }, 4000);
            }
        }

        // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', () => {
            new Enhanced3DPhotoWall();
            
            // Ê∑ªÂä†È°µÈù¢Âä†ËΩΩÂä®Áîª
            document.body.style.opacity = '0';
            setTimeout(() => {
                document.body.style.transition = 'opacity 1.2s ease';
                document.body.style.opacity = '1';
            }, 100);
        });
    </script>
</body>
</html>
